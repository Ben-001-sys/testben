{% extends "base.html" %}
{% block title %}animation{% endblock %}

{% block content %}
<div class="landing-container">
  <!-- Video side -->
  <div class="video-side" style="flex:1; display:flex; justify-content:center; align-items:flex-start; padding-top:40px;">
    <div id="videoTrigger" style="position:relative; width:600px; height:340px; cursor:pointer;">
      <!-- The video -->
      <iframe 
        src="https://www.youtube.com/embed/QEr8hJTKFeE?autoplay=1&mute=1&loop=1&playlist=QEr8hJTKFeE&enablejsapi=1"
        frameborder="0"
        allow="autoplay; fullscreen"
        allowfullscreen
        style="width:100%; height:100%; border:3px solid #ff00ff; border-radius:12px; box-shadow:0 0 20px rgba(255,0,255,0.5), 0 0 40px rgba(8,247,254,0.4);">
      </iframe>
      <!-- Transparent overlay -->
      <div style="position:absolute; top:0; left:0; width:100%; height:100%;"></div>
    </div>
  </div>

  <!-- Form side -->
  {% if username %}
  <div class="form-side">
    <div class="form-flip">
      <!-- Front side -->
      <div class="form-box form-front" style="background:rgba(10,10,20,0.9); padding:30px; border-radius:14px; box-shadow:0 0 25px rgba(0,255,200,0.5); text-align:center; width: 100%; border:2px solid rgba(0,255,200,0.4); position:relative; overflow:hidden; backface-visibility:hidden;">

        <!-- Futuristic border animation -->
        <div style="position:absolute; top:0; left:-100%; width:100%; height:3px; background:linear-gradient(90deg, transparent, #00ffcc, transparent); animation:scan 2s linear infinite;"></div>

        <p style="margin-top:15px; color:#00ff99; font-family:'Orbitron', sans-serif; font-size:30px; font-weight:bold;">
          Chapter: Animation
        </p>

        <!-- Scrollable info field -->
        <div class="info-pane" style="margin-top:18px; max-height:200px; overflow-y:auto; padding:12px 14px; border-top:2px solid #00ffcc; border-bottom:2px solid #00ffcc; background:rgba(8,12,20,0.6); text-align:left; font-size:14px; line-height:1.5; color:#ddd; font-family:'Segoe UI', sans-serif; scrollbar-width:thin; scrollbar-color:#00ffcc transparent;">
          <h2 style="font-weight:bold; color:#00ffaa; margin-bottom:6px; font-size:16px;">Animation Overview</h2>
          <p style="color: white;">Here's what you'll explore:</p>
          <p style="margin:10px 0 0 0;color: white;">Scroll for more…</p>
          <p style="margin:6px 0 0 0; color: white">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer vel dolor nec elit posuere auctor. Cras viverra nulla in erat vehicula, nec vestibulum libero dictum.</p>
        </div>
{% if all_visited %}
  <a href="/ending"
     style="display:inline-block; margin-top:20px; padding:12px 24px;
            background:linear-gradient(90deg,#ff00ff,#08f7fe);
            color:#fff; font-weight:bold; border-radius:10px;
            text-decoration:none; box-shadow:0 0 20px rgba(255,0,255,0.6);">
     Claim Your Reward
  </a>
{% endif %}
        <!-- Flip button -->
        <button onclick="flipForm()" style="margin-top:20px; padding:10px 16px; background:#00ffcc; color:#0a0a0f; border:none; border-radius:8px; font-weight:bold; cursor:pointer; font-family:'Orbitron', sans-serif; transition:0.3s;">
          ➡ Next
        </button>
      </div>

      <!-- Back side -->
      <div class="form-box form-back" style="background:rgba(10,10,20,0.9); padding:30px; border-radius:14px; box-shadow:0 0 25px rgba(0,255,200,0.5), inset 0 0 15px rgba(0,255,200,0.2); text-align:center; width:340px; border:2px solid rgba(0,255,200,0.4); position:absolute; top:0; left:0; overflow:hidden; backface-visibility:hidden; transform:rotateY(180deg);">

        <!-- Futuristic border animation -->
        <div style="position:absolute; top:0; left:-100%; width:100%; height:3px; background:linear-gradient(90deg, transparent, #00ffcc, transparent); animation:scan 2s linear infinite;"></div>

        <p style="margin-top:15px; color:#00ff99; font-family:'Orbitron', sans-serif; font-size:30px; font-weight:bold;">
          Welcome, {{ username }}!
        </p>

        <!-- Dropdown navigation -->
        <label for="navSelect" style="display:block; margin-top:20px; font-size:14px; color:#00ffcc; font-family:'Orbitron', sans-serif;">
          Choose a Destination:
        </label>
        <select id="navSelect" style="margin-top:10px; width:100%; padding:10px; border-radius:8px; background:#0a0a15; color:#00ffcc; border:1px solid #00ffcc; font-family:'Segoe UI', sans-serif; font-size:14px; cursor:pointer;" onchange="if(this.value) window.location.href=this.value;">
          <option value="">-- Select a Chapter --</option>
          <option value="/web-design" class="{% if '/web-design' in visited %}visited-option{% endif %}">Web Design</option>
          <option value="/AI" class="{% if '/AI' in visited %}visited-option{% endif %}">AI</option>
          <option value="/cyber-security" class="{% if '/cyber-security' in visited %}visited-option{% endif %}">Cyber Security</option>
          <option value="/ui-ux" class="{% if '/ui-ux' in visited %}visited-option{% endif %}">UI & UX</option>
          <option value="/computer-programming" class="{% if '/computer-programming' in visited %}visited-option{% endif %}">Computer Programming</option>
          <option value="/information-and-digital-literacy" class="{% if '/information-and-digital-literacy' in visited %}visited-option{% endif %}">Computer, Information and Digital Literacy</option>
          <option value="/animation" class="{% if '/animation' in visited %}visited-option{% endif %}">Animation</option>
          <option value="/graphic-design" class="{% if '/graphic-design' in visited %}visited-option{% endif %}">Graphic Design</option>
          <option value="/digital-marketing" class="{% if '/digital-marketing' in visited %}visited-option{% endif %}">Digital Marketing</option>
          <option value="/sound-video-editing" class="{% if '/sound-video-editing' in visited %}visited-option{% endif %}">Sound & Video Editing</option>
        </select>

        <!-- Back button -->
        <button onclick="flipForm()" style="margin-top:20px; padding:10px 16px; background:#00ffcc; color:#0a0a0f; border:none; border-radius:8px; font-weight:bold; cursor:pointer; font-family:'Orbitron', sans-serif; transition:0.3s;">
          ⬅ Back
        </button>
      </div>
    </div>
  </div>
  {% else %}
  <!-- Default form when no username -->
  <div class="form-side">
    <div class="form-box" style="background:rgba(25,25,40,0.9); padding:30px; border-radius:15px; box-shadow:0 0 20px rgba(0,255,150,0.2); text-align:center; width:350px;">
      <h1 style="color:#00ff99; font-family:'Orbitron', sans-serif; font-size:30px; margin-bottom:15px;">Welcome, Stranger!</h1>
      <p style="color:#aaa; font-family:sans-serif; font-size:14px; margin-bottom:30px;">________________________________<br><br>I am about to embark on a very interesting journey. And I am taking you with me. But first, how should I address you?<br>________________________________</p>
      <form method="post" action="/save">
        <input type="text" name="name" placeholder="Enter your name" required style="width:85%; padding:20px; margin-bottom:15px; border:none; border-radius:8px; background:#111; color:#fff; font-size:14px; outline:none; box-shadow:0 0 10px rgba(0,255,150,0.3) inset;">
        <button type="submit" style="width:80%; padding:12px; background:linear-gradient(90deg, #00ff99, #00ccff); color:#0a0a0a; font-weight:bold; border:none; border-radius:8px; font-size:14px; cursor:pointer; transition:all 0.3s ease; box-shadow:0 0 15px rgba(0,255,200,0.5);">
          Start Journey
        </button>
      </form>
    </div>
  </div>
  {% endif %}
</div>

<!-- Overlay -->
<div id="overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:900;"></div>

<!-- Modal -->
<div id="videoModal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; justify-content:center; align-items:center;">
  <div style="background:#111; padding:15px; border-radius:12px; width:90%; max-width:900px; box-shadow:0 0 25px #ff00ff, 0 0 50px #08f7fe; position:relative;">
    <span id="closeModal" style="color:#fff; position:absolute; top:10px; right:15px; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
    <iframe id="modalVideo" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen style="width:100%; height:500px; border-radius:12px;"></iframe>
  </div>
</div>

<style>
.visited-option {
  text-decoration: line-through;
  color: #777 !important;
}

/* ------- Flip card layout (stable stacking & hit-testing) ------- */
.form-flip {
  position: relative;
  width: 340px;
  height: auto;
  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;
  transition: transform 0.8s;
  perspective: 1200px;            /* helps 3D rendering */
  -webkit-perspective: 1200px;
}

/* front & back occupy same area */
.form-front,
.form-back {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  -webkit-transform-style: preserve-3d;
  transform-style: preserve-3d;
  overflow: visible;              /* let dropdowns overflow */
  pointer-events: none;           /* disabled until visible */
}

.form-back {
  transform: rotateY(180deg);
}

.form-flip.flipped {
  transform: rotateY(180deg);
}

/* z-index handling */
.form-flip:not(.flipped) .form-front { z-index: 3; pointer-events: auto; }
.form-flip:not(.flipped) .form-back  { z-index: 1; pointer-events: none; }
.form-flip.flipped .form-front       { z-index: 1; pointer-events: none; }
.form-flip.flipped .form-back        { z-index: 3; pointer-events: auto; }

/* ------- Scrollable info-pane (mobile friendly) ------- */
.form-box {
  min-height: 400px;
}

.form-box .info-pane {
  overflow-y: auto !important;
  max-height: 200px;
  -webkit-overflow-scrolling: touch !important;
  touch-action: pan-y;
  overscroll-behavior: contain;
  position: relative;
  z-index: 1;
}

@media (max-width: 600px) {
  .form-box .info-pane { max-height: 45vh; }
}

/* Custom scrollbars */
.form-box .info-pane::-webkit-scrollbar { width: 8px; }
.form-box .info-pane::-webkit-scrollbar-track { background: transparent; margin: 6px 0; }
.form-box .info-pane::-webkit-scrollbar-thumb { background: #00ffcc; border-radius: 4px; box-shadow: 0 0 8px #00ffcc; }
.form-box .info-pane::-webkit-scrollbar-thumb:hover { background: #00ffaa; }

/* ------- Keep backside controls clickable ------- */
.form-back select,
.form-back button,
.form-back label,
.form-back .nav,
.form-back .visited-option {
  position: relative;
  z-index: 4;
  pointer-events: auto;
}

/* iOS tweak */
@supports (-webkit-touch-callout: none) {
  .form-flip { perspective: 1000px; -webkit-perspective: 1000px; }
}

@keyframes scan { 0%{left:-100%;} 100%{left:100%;} }

</style>

<script>
function flipForm() {
  document.querySelector(".form-flip").classList.toggle("flipped");
}
document.addEventListener("DOMContentLoaded", () => {
  const trigger = document.getElementById("videoTrigger");
  const modal = document.getElementById("videoModal");
  const overlay = document.getElementById("overlay");
  const closeBtn = document.getElementById("closeModal");
  const modalVideo = document.getElementById("modalVideo");
  const videoURL = "https://www.youtube.com/embed/QEr8hJTKFeE?autoplay=1&mute=0";

  trigger.addEventListener("click", () => {
    modal.style.display = "flex";
    overlay.style.display = "block";
    modalVideo.src = videoURL;
  });
  closeBtn.addEventListener("click", () => {
    modal.style.display = "none";
    overlay.style.display = "none";
    modalVideo.src = "";
  });
  overlay.addEventListener("click", () => {
    modal.style.display = "none";
    overlay.style.display = "none";
    modalVideo.src = "";
  });
});
</script>
{% endblock %}
